# Relay Client Guide

The objective of this project is to go over the documentation of Relay and ilustrate it with practical cases for the lessons in the Relay documentation.

You can use this project by checking out the different tags that correspond to the respective lessons in the Relay site documentation.

I am starting to introduce [Flow](https://flow.org/) annotations, as the application gains in complexity, and after having spending some time learning it, it seems like a good tool to get a better grasp to the application. In this evolution I am doing more use of it. Using FLow with relay forces you to a more extensive check of possible `undefined` and `null` responses, which is not a bad thing.

When reviewing or checking out this code, I would assume that you have already gone over the following tags:

- [getting-started](https://github.com/rafasanmartinez/relay-client-guide/tree/getting-started)
- [rendering-quieries](https://github.com/rafasanmartinez/relay-client-guide/tree/rendering-quieries)
- [rendering-fragments](https://github.com/rafasanmartinez/relay-client-guide/tree/rendering-fragments)
- [rendering-fragments-2](https://github.com/rafasanmartinez/relay-client-guide/tree/rendering-fragments-2)
- [rendering-fragments-3](https://github.com/rafasanmartinez/relay-client-guide/tree/rendering-fragments-3)
- [variables](https://github.com/rafasanmartinez/relay-client-guide/tree/variables)
- [variables-2](https://github.com/rafasanmartinez/relay-client-guide/tree/variables-2)
- [suspense](https://github.com/rafasanmartinez/relay-client-guide/tree/suspense)
- [error-boundaries](https://github.com/rafasanmartinez/relay-client-guide/tree/error-boundaries)
- [fetch-policies](https://github.com/rafasanmartinez/relay-client-guide/tree/fetch-policies)
- [presence-of-data](https://github.com/rafasanmartinez/relay-client-guide/tree/presence-of-data)
- [presence-of-data-2](https://github.com/rafasanmartinez/relay-client-guide/tree/presence-of-data-2)
- [pagination](https://github.com/rafasanmartinez/relay-client-guide/tree/pagination)

It will be interesting for you to inspect the internals of the `Store` by installing the [Relay Developer Tools](https://chrome.google.com/webstore/detail/relay-developer-tools/ncedobpgnmkhcmnnkcimnobpfepidadl) extension to follow these samples.

## Specific to this sample: routing

This sample is a significant evolution of [pagination](https://github.com/rafasanmartinez/relay-client-guide/tree/pagination).

The application is new able to display the issues in the search, and upon clicking the name of one issue, it takes you to another page where you can see the issue and the comments fir the issue.

I am detailing the improvements added below:

### Application routing

I have decided to use [found](https://github.com/4Catalyzer/found) to produce routing between pages in the application. You can find details on how it is used in the files `index.js`, `App.js` and `IssuseList.js`. The use of [found](https://github.com/4Catalyzer/found) allows you to preload the data during the routing, and then use the data in the component that only have to take care of displaying it.

You get to achieve that with the `getData` argument of the `Route` component, where you pass a function that will call `loadQuery`, and by providing the parameters of the route using the `Link` component (see the file `IssuesList.js` where the `Link` gets used.

In order to demonstrate the orchestation of routes, location states, parameters, and react context, I have proposed a means to obtain the github repository data for the Issue component as an additional firld in the root of the Issue query. I am aware that I can just get that data without so much ado because Repository is a descendant of Issue in the schema. However, I wanted to demo the functionality. As a colateral effect, you will break the application if you add anything to the root url, because the loation state dose not get populated by the `Link` component. Do not worry about that. This is just for see how things work. 

Detailed information about how this is done is provided in the comments in the files mentioned.

### Using the files generated by Relay for routing

You can find in this application some use of the files generated by the Relay compiler for type checking and exporting components and functions. See some of that in the `Issue.js` file and the helper functions

### Using Flow

Additionally, I am introducing the use of `Flow` in all the helper functions. It seems to work nicelly when I have to call them from other modules.

### Improvement of the interface with css

I have improved the apperance of the screen by cleaning up the css schema files, eliminate the inline css that was still in the application, and use `flex` to limit the width of the page bodies.

### Schema definition update

I have downloaded and incorporated the newer version of [GitHub´s GraphQL server schema](https://docs.github.com/en/graphql/overview/public-schema)

In order to see what is going on with the relay store, you should to install the [Relay Developer Tools](https://chrome.google.com/webstore/detail/relay-developer-tools/ncedobpgnmkhcmnnkcimnobpfepidadl)

It will be very useful to see the [GitHub´s GraphQL API Reference](https://docs.github.com/en/graphql), specially the following entries:

- [Repository Object](https://docs.github.com/en/graphql/reference/objects#repository)
- [IssueConnection Object](https://docs.github.com/en/graphql/reference/objects#issueconnection)
- [IssueEdge Object](https://docs.github.com/en/graphql/reference/objects#issueconnection)
- [Issue Object](https://docs.github.com/en/graphql/reference/objects#issueconnection)

You may also take advantage and watch in the code how you can use React hooks controlled inputs (see Mentions section below).

## Configure and run this sample

This project connects to the Github GraphQL server. You can find information about it in the [Github GraphQL API](https://docs.github.com/es/graphql) site.

- Checkout the project and do `npm install` to install the required libraries.
- [Create a Personal Access Token in Github](https://docs.github.com/es/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token) and store it in a safe place.
- Create a file in the root folder with the name `.env.local`
- Enter the following line in the `.env.local` file. This creates an environment variable that ls used later in `./src/fetchGraphQL.js`

```sh
REACT_APP_GITHUB_AUTH_TOKEN=(YOUR TOKEN)
```

- Do `npm run relay`
- Do `npm start`.

## Mentions

The helper function `userInput` comes from Evan Schultz in his [blog entry](https://rangle.io/blog/simplifying-controlled-inputs-with-hooks/)
